# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –í–Ω–µ–¥—Ä–µ–Ω–∏—é AR-–ü–æ–∫—Ä–∞—Å–∫–∏

## –û–±–∑–æ—Ä –ò–∑–º–µ–Ω–µ–Ω–∏–π

–ú—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ **–†–∞–∑–¥–µ–ª—ã 1, 2 –∏ 3** —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ - —Å–æ–∑–¥–∞–ª–∏ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–æ–∫—Ä–∞—Å–∫–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π –≤ AR.

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –§—É–Ω–∫—Ü–∏–∏

**–†–∞–∑–¥–µ–ª 1: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ö–æ–Ω–≤–µ–π–µ—Ä–∞**
1. **GPU-—Ü–µ–Ω—Ç—Ä–∏—á–Ω—ã–π –∑–∞—Ö–≤–∞—Ç –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞** - `CameraFeedCapture.cs`
2. **–ì–ª–æ–±–∞–ª—å–Ω–∞—è —à–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —à–µ–π–¥–µ—Ä–æ–≤** - –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã `SegmentationManager.cs` –∏ `PaintManager.cs`
3. **SurfacePaintShader —Å —ç–∫—Ä–∞–Ω–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏** - –±–∞–∑–æ–≤—ã–π —à–µ–π–¥–µ—Ä –ø–æ–∫—Ä–∞—Å–∫–∏

**–†–∞–∑–¥–µ–ª 2: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –¢–µ—Ö–Ω–∏–∫–∏ –®–µ–π–¥–∏–Ω–≥–∞**
4. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ä–µ–∂–∏–º—ã —Å–º–µ—à–∏–≤–∞–Ω–∏—è** - Normal, Multiply, Overlay, Soft Light
5. **PBR Surface Shader** - `PBRSurfacePaintShader.shader` –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è

**–†–∞–∑–¥–µ–ª 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –û–ø—ã—Ç**
6. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π UI** - `UIManager.cs` —Å –ø–∞–ª–∏—Ç—Ä–æ–π —Ü–≤–µ—Ç–æ–≤ –∏ —Ä–µ–∂–∏–º–∞–º–∏ —Å–º–µ—à–∏–≤–∞–Ω–∏—è
7. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏** - `SurfaceHighlighter.cs`
8. **–ü–∞—Ç—Ç–µ—Ä–Ω –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Undo/Redo** - `CommandSystem.cs` —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π –¥–µ–π—Å—Ç–≤–∏–π

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –°—Ü–µ–Ω—ã

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AR Camera

1. **–î–æ–±–∞–≤—å—Ç–µ `CameraFeedCapture`** –∫ AR Camera:
   ```
   AR Camera GameObject
   ‚îú‚îÄ‚îÄ ARCameraManager (—É–∂–µ –µ—Å—Ç—å)
   ‚îú‚îÄ‚îÄ ARCameraBackground (—É–∂–µ –µ—Å—Ç—å)
   ‚îî‚îÄ‚îÄ CameraFeedCapture (–ù–û–í–´–ô) ‚Üê –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫–∏** –≤ `CameraFeedCapture`:
   - `Camera Manager` ‚Üí ARCameraManager
   - `Camera Background` ‚Üí ARCameraBackground

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SegmentationManager

–í –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–µ `SegmentationManager` –¥–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É:
- `Camera Feed Capture` ‚Üí –æ–±—ä–µ–∫—Ç —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º CameraFeedCapture

### 3. –°–æ–∑–¥–∞–Ω–∏–µ Material –¥–ª—è –ü–æ–∫—Ä–∞—Å–∫–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Material: `Assets/Materials/PaintMaterial.mat`
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Shader: `Unlit/SurfacePaintShader`
3. –ù–∞–∑–Ω–∞—á—å—Ç–µ —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª –≤ `PaintManager.paintMaterial`

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UI (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π UI:

```
Canvas
‚îú‚îÄ‚îÄ ColorPalette Panel
‚îÇ   ‚îú‚îÄ‚îÄ RedButton (Image + Button + ColorButton script)
‚îÇ   ‚îú‚îÄ‚îÄ GreenButton (Image + Button + ColorButton script)  
‚îÇ   ‚îú‚îÄ‚îÄ BlueButton (Image + Button + ColorButton script)
‚îÇ   ‚îî‚îÄ‚îÄ YellowButton (Image + Button + ColorButton script)
‚îú‚îÄ‚îÄ ClearButton (Button)
‚îî‚îÄ‚îÄ UIManager (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞ Canvas)
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫:**
1. –ö–∞–∂–¥–æ–π —Ü–≤–µ—Ç–Ω–æ–π –∫–Ω–æ–ø–∫–µ –¥–æ–±–∞–≤—å—Ç–µ `ColorButton` script
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ü–≤–µ—Ç –≤ Image component –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏
3. –í `UIManager` –Ω–∞–∑–Ω–∞—á—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ `PaintManager` –∏ `SegmentationManager`
4. ClearButton –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å `UIManager.OnClearButtonClicked()`

## –ù–æ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ –î–∞–Ω–Ω—ã—Ö

```
AR Camera ‚Üí CameraFeedCapture ‚Üí Shader.SetGlobalTexture("_GlobalCameraFeedTex")
                                                ‚Üì
Sentis ML ‚Üí SegmentationManager ‚Üí Shader.SetGlobalTexture("_GlobalSegmentationTex")
                                                ‚Üì
User Tap ‚Üí SegmentationManager ‚Üí Shader.SetGlobalInt("_GlobalTargetClassID")
                                                ‚Üì
                                    SurfacePaintShader (–Ω–∞ –º–µ—à–∞—Ö)
```

### –ö–ª—é—á–µ–≤—ã–µ –ò–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ù–µ—Ç –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –º–µ–∂–¥—É –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ —à–µ–π–¥–µ—Ä–æ–≤
2. **–û–¥–∏–Ω CommandBuffer** –∫–æ–ø–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä—É –∫–∞–º–µ—Ä—ã –±–µ–∑ –æ–ø–µ—Ä–∞—Ü–∏–π CPU‚ÜíGPU‚ÜíCPU
3. **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π PaintManager** - —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–µ—Ç –º–µ—à–∏, –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–º–∏
4. **–®–µ–π–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–∫—Ä–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞

## –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ü–µ–Ω—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **–†–∞–∑–¥–µ–ª 2**: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ä–µ–∂–∏–º—ã —Å–º–µ—à–∏–≤–∞–Ω–∏—è (Multiply, Overlay, PBR)
- **–†–∞–∑–¥–µ–ª 3**: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∏ Undo/Redo
- **–†–∞–∑–¥–µ–ª 4**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (async/await, AsyncGPUReadback)

## Troubleshooting

**–ï—Å–ª–∏ –ø–æ–∫—Ä–∞—Å–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å Unity –Ω–∞ –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `_GlobalTargetClassID != -1` (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ —Ç–∞–ø)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `_GlobalCameraFeedTex` –∏ `_GlobalSegmentationTex` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
4. –í Frame Debugger –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–µ—à–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —à–µ–π–¥–µ—Ä–æ–º

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤–∞—è, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±—É–¥—É—Ç –≤ –†–∞–∑–¥–µ–ª–µ 4
- AsyncGPUReadback –¥–ª—è —Ç–∞–ø–æ–≤ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω—ã–π CPU Argmax)

---

## üéØ –û–ë–ù–û–í–õ–ï–ù–ò–ï: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –†–∞–∑–¥–µ–ª—ã 1-3!

### ‚úÖ –ù–æ–≤—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–î–æ–±–∞–≤–ª–µ–Ω—ã)

**–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –®–µ–π–¥–µ—Ä—ã:**
- `Assets/Shaders/SurfacePaintShader.shader` - —Å 4 —Ä–µ–∂–∏–º–∞–º–∏ —Å–º–µ—à–∏–≤–∞–Ω–∏—è
- `Assets/Shaders/PBRSurfacePaintShader.shader` - –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è

**UX –°–∏—Å—Ç–µ–º–∞:**  
- `Assets/Scripts/SurfaceHighlighter.cs` - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π
- `Assets/Scripts/CommandSystem.cs` - Undo/Redo —á–µ—Ä–µ–∑ –ø–∞—Ç—Ç–µ—Ä–Ω –ö–æ–º–∞–Ω–¥–∞
- `Assets/Scripts/UIManager.cs` - —Ä–∞—Å—à–∏—Ä–µ–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

### üé® –ù–æ–≤—ã–µ –§—É–Ω–∫—Ü–∏–∏

1. **–†–µ–∂–∏–º—ã –°–º–µ—à–∏–≤–∞–Ω–∏—è**: Normal, Multiply, Overlay, Soft Light
2. **PBR –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã  
3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ü–æ–¥—Å–≤–µ—Ç–∫–∞**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–¥–µ –±—É–¥–µ—Ç –ø–æ–∫—Ä–∞—Å–∫–∞
4. **Undo/Redo**: –ò—Å—Ç–æ—Ä–∏—è –¥–æ 20 –¥–µ–π—Å—Ç–≤–∏–π —Å –ø–æ–ª–Ω—ã–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π UI**: Dropdown —Ä–µ–∂–∏–º–æ–≤ + –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üöÄ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ì–ª–æ–±–∞–ª—å–Ω–∞—è —à–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö + GPU-—Ü–µ–Ω—Ç—Ä–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º AR –º–µ—à–µ–π
- **–ö–∞—á–µ—Å—Ç–≤–æ**: PBR –º–∞—Ç–µ—Ä–∏–∞–ª—ã + –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã —Å–º–µ—à–∏–≤–∞–Ω–∏—è  
- **UX**: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ + –Ω–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–º–µ–Ω—ã

*‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω! –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É —Ä–∞–∑–¥–µ–ª–æ–≤ 1-3.* 